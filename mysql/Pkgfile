# Description: SQL database server
# URL: http://www.mysql.com
# Maintainer: Mikhail Kolesnik, mike at openbunker dot org
# Depends on: ncurses zlib openssl readline

# juergen dot daubert at t-online dot de's ports were templates

name=mysql
version=5.1.54
release=1
source=(http://mirror.switch.ch/mirror/mysql/Downloads/MySQL-5.1/$name-$version.tar.gz \
		my.cnf mysqld)

build () {
	cd $name-$version
	./configure --prefix=/usr \
				--sysconfdir=/etc \
				--libexecdir=/usr/sbin \
				--localstatedir=/srv/db/mysql \
				--mandir=/usr/man \
				--enable-assembler \
				--enable-thread-safe-client \
				--with-extra-charsets=complex \
				--without-debug \
				--without-docs \
				--without-readline \
				--with-ssl \
				--with-plugins=myisam,innobase
	make
	make DESTDIR=$PKG install

	rm -r $PKG/usr/mysql-test
	rm $PKG/usr/share/mysql/charsets/README
	find $PKG/usr/share/mysql/* -prune -type f ! -regex '.*\(cnf\|sql\)$' | xargs rm -f {} \;
	find $PKG/usr/share/mysql/* -type d ! -name english ! -name charsets | xargs rm -rf {} \;
	mkdir -p $PKG/{var/log/mysql,var/run,srv/db}
	chown daemon:daemon $PKG/var/log/mysql
	install -d -m 700 -o daemon -g daemon $PKG/srv/db/mysql
	install -D -m 755 $SRC/mysqld $PKG/etc/rc.d/mysqld
	install -m 600 $SRC/my.cnf $PKG/etc
	
	install -d $PKG/etc/ld.so.conf.d
	echo "/usr/lib/mysql" > $PKG/etc/ld.so.conf.d/mysql.conf
}
